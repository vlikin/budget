"use strict";var app=angular.module("appModule",["LocalStorageModule","ngRoute","phoneControllers"]);app.config(["$routeProvider",function(e){e.when("/user/login",{templateUrl:"/static/app/partials/user-login.html",controller:"User-loginController"}).when("/phones",{templateUrl:"/static/app/partials/phone-list.html",controller:"Phone-ListCtrl"}).when("/phones/:phoneId",{templateUrl:"/static/app/partials/phone-detail.html",controller:"Phone-DetailCtrl"}).otherwise({redirectTo:"/phones"})}]),app.constant("AUTH_EVENTS",{loginSuccess:"auth-login-success",loginFailed:"auth-login-failed",logoutSuccess:"auth-logout-success",sessionTimeout:"auth-session-timeout",notAuthenticated:"auth-not-authenticated",notAuthorized:"auth-not-authorized"}),app.constant("USER_ROLES",{all:"*",admin:"admin",editor:"editor",guest:"guest"}),app.service("Session",function(){return this.create=function(e,t,o){this.id=e,this.userId=t,this.userRole=o},this.destroy=function(){this.id=null,this.userId=null,this.userRole=null},this}),app.factory("AuthService",["$http","Session","USER_ROLES",function(e,t,o){var n={};return n.login=function(n){return e.post("/user/rest/login",n).then(function(e){return console.log(e.data),e.data.success?(t.create(e.data.id,e.data.user.id,o.admin),e.data.user):!1})},n.isAuthenticated=function(){return!!t.userId},n.isAuthorized=function(e){return angular.isArray(e)||(e=[e]),n.isAuthenticated()&&-1!==e.indexOf(t.userRole)},n}]),app.factory("authService",["$http","$q","localStorageService",function(e,t,o){var n="http://ngauthenticationapi.azurewebsites.net/",r={},s={isAuth:!1,userName:""},a=function(t){return u(),e.post(n+"api/account/register",t).then(function(e){return e})},i=function(r){console.log("_login");var a="grant_type=password&username="+r.userName+"&password="+r.password,i=t.defer();return e.post(n+"token",a,{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e){o.set("authorizationData",{token:e.access_token,userName:r.userName}),s.isAuth=!0,s.userName=r.userName,console.log(e),i.resolve(e)}).error(function(){s.isAuth=!0,s.userName=r.userName,i.resolve({a:"s"}),console.log("error")}),i.promise},u=function(){o.remove("authorizationData"),s.isAuth=!1,s.userName=""},l=function(){var e=o.get("authorizationData");e&&(s.isAuth=!0,s.userName=e.userName)};return r.saveRegistration=a,r.login=i,r.logOut=u,r.fillAuthData=l,r.authentication=s,r}]),app.factory("authInterceptorService",["$q","$location","localStorageService",function(e,t,o){var n={},r=function(e){e.headers=e.headers||{};var t=o.get("authorizationData");return t&&(e.headers.Authorization="Bearer "+t.token),e},s=function(o){return 401===o.status&&t.path("/login"),e.reject(o)};return n.request=r,n.responseError=s,n}]),app.config(["$httpProvider",function(e){e.interceptors.push("authInterceptorService")}]);var phoneControllers=angular.module("phoneControllers",[]);phoneControllers.constant("AUTH_EVENTS",{loginSuccess:"auth-login-success",loginFailed:"auth-login-failed",logoutSuccess:"auth-logout-success",sessionTimeout:"auth-session-timeout",notAuthenticated:"auth-not-authenticated",notAuthorized:"auth-not-authorized"}),phoneControllers.controller("User-SignupController_",["$scope","USER_ROLES","AuthService",function(e,t,o){e.currentUser=null,e.userRoles=t,e.isAuthorized=o.isAuthorized,e.setCurrentUser=function(t){e.currentUser=t}}]),phoneControllers.controller("User-loginController",["$scope","$rootScope","AUTH_EVENTS","AuthService",function(e,t,o,n){console.log("init"),e.credentials={username:"login",password:"password"},e.login=function(r){n.login(r).then(function(n){t.$broadcast(o.loginSuccess),e.setCurrentUser(n)},function(){t.$broadcast(o.loginFailed)})}}]),phoneControllers.controller("Phone-ListCtrl",["$scope","$http",function(e,t){t.get("/static/app/phones/phones.json").success(function(t){e.phones=t}),e.orderProp="age"}]),phoneControllers.controller("Phone-DetailCtrl",["$scope","$routeParams",function(e,t){e.phoneId=t.phoneId}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImNvbnRyb2xsZXJzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLFlBRUEsSUFBQSxLQUFBLFFBQUEsT0FBQSxhQUNBLHFCQUNBLFVBQ0Esb0JBR0EsS0FBQSxRQUFBLGlCQUNBLFNBQUEsR0FDQSxFQUNBLEtBQUEsZUFDQSxZQUFBLHVDQUNBLFdBQUEseUJBRUEsS0FBQSxXQUNBLFlBQUEsdUNBQ0EsV0FBQSxtQkFFQSxLQUFBLG9CQUNBLFlBQUEseUNBQ0EsV0FBQSxxQkFFQSxXQUNBLFdBQUEsZUFLQSxJQUFBLFNBQUEsZUFDQSxhQUFBLHFCQUNBLFlBQUEsb0JBQ0EsY0FBQSxzQkFDQSxlQUFBLHVCQUNBLGlCQUFBLHlCQUNBLGNBQUEsd0JBR0EsSUFBQSxTQUFBLGNBQ0EsSUFBQSxJQUNBLE1BQUEsUUFDQSxPQUFBLFNBQ0EsTUFBQSxVQUlBLElBQUEsUUFBQSxVQUFBLFdBV0EsTUFWQSxNQUFBLE9BQUEsU0FBQSxFQUFBLEVBQUEsR0FDQSxLQUFBLEdBQUEsRUFDQSxLQUFBLE9BQUEsRUFDQSxLQUFBLFNBQUEsR0FFQSxLQUFBLFFBQUEsV0FDQSxLQUFBLEdBQUEsS0FDQSxLQUFBLE9BQUEsS0FDQSxLQUFBLFNBQUEsTUFFQSxPQUlBLElBQUEsUUFBQSxlQUFBLFFBQUEsVUFBQSxhQUFBLFNBQUEsRUFBQSxFQUFBLEdBQ0EsR0FBQSxLQTRCQSxPQTFCQSxHQUFBLE1BQUEsU0FBQSxHQUNBLE1BQUEsR0FDQSxLQUFBLG1CQUFBLEdBQ0EsS0FBQSxTQUFBLEdBRUEsTUFEQSxTQUFBLElBQUEsRUFBQSxNQUNBLEVBQUEsS0FBQSxTQUNBLEVBQUEsT0FBQSxFQUFBLEtBQUEsR0FBQSxFQUFBLEtBQUEsS0FBQSxHQUFBLEVBQUEsT0FDQSxFQUFBLEtBQUEsT0FHQSxLQUlBLEVBQUEsZ0JBQUEsV0FDQSxRQUFBLEVBQUEsUUFHQSxFQUFBLGFBQUEsU0FBQSxHQUlBLE1BSEEsU0FBQSxRQUFBLEtBQ0EsR0FBQSxJQUVBLEVBQUEsbUJBQ0EsS0FBQSxFQUFBLFFBQUEsRUFBQSxXQUdBLEtBR0EsSUFBQSxRQUFBLGVBQUEsUUFBQSxLQUFBLHNCQUFBLFNBQUEsRUFBQSxFQUFBLEdBRUEsR0FBQSxHQUFBLGdEQUNBLEtBRUEsR0FDQSxRQUFBLEVBQ0EsU0FBQSxJQUdBLEVBQUEsU0FBQSxHQUlBLE1BRkEsS0FFQSxFQUFBLEtBQUEsRUFBQSx1QkFBQSxHQUFBLEtBQUEsU0FBQSxHQUNBLE1BQUEsTUFLQSxFQUFBLFNBQUEsR0FFQSxRQUFBLElBQUEsU0FDQSxJQUFBLEdBQUEsZ0NBQUEsRUFBQSxTQUFBLGFBQUEsRUFBQSxTQUVBLEVBQUEsRUFBQSxPQXFCQSxPQW5CQSxHQUFBLEtBQUEsRUFBQSxRQUFBLEdBQUEsU0FBQSxlQUFBLHVDQUFBLFFBQUEsU0FBQSxHQUVBLEVBQUEsSUFBQSxxQkFBQSxNQUFBLEVBQUEsYUFBQSxTQUFBLEVBQUEsV0FFQSxFQUFBLFFBQUEsRUFDQSxFQUFBLFNBQUEsRUFBQSxTQUNBLFFBQUEsSUFBQSxHQUNBLEVBQUEsUUFBQSxLQUVBLE1BQUEsV0FDQSxFQUFBLFFBQUEsRUFDQSxFQUFBLFNBQUEsRUFBQSxTQUNBLEVBQUEsU0FBQSxFQUFBLE1BQ0EsUUFBQSxJQUFBLFdBTUEsRUFBQSxTQUlBLEVBQUEsV0FFQSxFQUFBLE9BQUEscUJBRUEsRUFBQSxRQUFBLEVBQ0EsRUFBQSxTQUFBLElBSUEsRUFBQSxXQUVBLEdBQUEsR0FBQSxFQUFBLElBQUEsb0JBQ0EsS0FFQSxFQUFBLFFBQUEsRUFDQSxFQUFBLFNBQUEsRUFBQSxVQVdBLE9BTkEsR0FBQSxpQkFBQSxFQUNBLEVBQUEsTUFBQSxFQUNBLEVBQUEsT0FBQSxFQUNBLEVBQUEsYUFBQSxFQUNBLEVBQUEsZUFBQSxFQUVBLEtBR0EsSUFBQSxRQUFBLDBCQUFBLEtBQUEsWUFBQSxzQkFBQSxTQUFBLEVBQUEsRUFBQSxHQUVBLEdBQUEsTUFFQSxFQUFBLFNBQUEsR0FFQSxFQUFBLFFBQUEsRUFBQSxXQUVBLElBQUEsR0FBQSxFQUFBLElBQUEsb0JBS0EsT0FKQSxLQUNBLEVBQUEsUUFBQSxjQUFBLFVBQUEsRUFBQSxPQUdBLEdBR0EsRUFBQSxTQUFBLEdBSUEsTUFIQSxPQUFBLEVBQUEsUUFDQSxFQUFBLEtBQUEsVUFFQSxFQUFBLE9BQUEsR0FNQSxPQUhBLEdBQUEsUUFBQSxFQUNBLEVBQUEsY0FBQSxFQUVBLEtBR0EsSUFBQSxRQUFBLGdCQUFBLFNBQUEsR0FDQSxFQUFBLGFBQUEsS0FBQSw0QkMxTUEsSUFBQSxrQkFBQSxRQUFBLE9BQUEsc0JBRUEsa0JBQUEsU0FBQSxlQUNBLGFBQUEscUJBQ0EsWUFBQSxvQkFDQSxjQUFBLHNCQUNBLGVBQUEsdUJBQ0EsaUJBQUEseUJBQ0EsY0FBQSx3QkFHQSxpQkFBQSxXQUFBLDBCQUFBLFNBQUEsYUFBQSxjQUFBLFNBQUEsRUFBQSxFQUFBLEdBQ0EsRUFBQSxZQUFBLEtBQ0EsRUFBQSxVQUFBLEVBQ0EsRUFBQSxhQUFBLEVBQUEsYUFFQSxFQUFBLGVBQUEsU0FBQSxHQUNBLEVBQUEsWUFBQSxNQUlBLGlCQUFBLFdBQUEsd0JBQUEsU0FBQSxhQUFBLGNBQUEsY0FBQSxTQUFBLEVBQUEsRUFBQSxFQUFBLEdBQ0EsUUFBQSxJQUFBLFFBQ0EsRUFBQSxhQUNBLFNBQUEsUUFDQSxTQUFBLFlBR0EsRUFBQSxNQUFBLFNBQUEsR0FDQSxFQUFBLE1BQUEsR0FBQSxLQUFBLFNBQUEsR0FDQSxFQUFBLFdBQUEsRUFBQSxjQUNBLEVBQUEsZUFBQSxJQUNBLFdBQ0EsRUFBQSxXQUFBLEVBQUEsbUJBS0EsaUJBQUEsV0FBQSxrQkFBQSxTQUFBLFFBQ0EsU0FBQSxFQUFBLEdBQ0EsRUFBQSxJQUFBLGtDQUFBLFFBQUEsU0FBQSxHQUNBLEVBQUEsT0FBQSxJQUdBLEVBQUEsVUFBQSxTQUdBLGlCQUFBLFdBQUEsb0JBQUEsU0FBQSxlQUNBLFNBQUEsRUFBQSxHQUNBLEVBQUEsUUFBQSxFQUFBIiwiZmlsZSI6ImFwcC5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxudmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdhcHBNb2R1bGUnLCBbXG4gICdMb2NhbFN0b3JhZ2VNb2R1bGUnLFxuICAnbmdSb3V0ZScsXG4gICdwaG9uZUNvbnRyb2xsZXJzJ1xuXSk7XG5cbmFwcC5jb25maWcoWyckcm91dGVQcm92aWRlcicsXG4gIGZ1bmN0aW9uKCRyb3V0ZVByb3ZpZGVyKSB7XG4gICAgJHJvdXRlUHJvdmlkZXIuXG4gICAgICB3aGVuKCcvdXNlci9sb2dpbicsIHtcbiAgICAgICAgdGVtcGxhdGVVcmw6ICcvc3RhdGljL2FwcC9wYXJ0aWFscy91c2VyLWxvZ2luLmh0bWwnLFxuICAgICAgICBjb250cm9sbGVyOiAnVXNlci1sb2dpbkNvbnRyb2xsZXInXG4gICAgICB9KS5cbiAgICAgIHdoZW4oJy9waG9uZXMnLCB7XG4gICAgICAgIHRlbXBsYXRlVXJsOiAnL3N0YXRpYy9hcHAvcGFydGlhbHMvcGhvbmUtbGlzdC5odG1sJyxcbiAgICAgICAgY29udHJvbGxlcjogJ1Bob25lLUxpc3RDdHJsJ1xuICAgICAgfSkuXG4gICAgICB3aGVuKCcvcGhvbmVzLzpwaG9uZUlkJywge1xuICAgICAgICB0ZW1wbGF0ZVVybDogJy9zdGF0aWMvYXBwL3BhcnRpYWxzL3Bob25lLWRldGFpbC5odG1sJyxcbiAgICAgICAgY29udHJvbGxlcjogJ1Bob25lLURldGFpbEN0cmwnXG4gICAgICB9KS5cbiAgICAgIG90aGVyd2lzZSh7XG4gICAgICAgIHJlZGlyZWN0VG86ICcvcGhvbmVzJ1xuICAgICAgfSk7XG4gIH1dKTtcblxuXG5hcHAuY29uc3RhbnQoJ0FVVEhfRVZFTlRTJywge1xuICBsb2dpblN1Y2Nlc3M6ICdhdXRoLWxvZ2luLXN1Y2Nlc3MnLFxuICBsb2dpbkZhaWxlZDogJ2F1dGgtbG9naW4tZmFpbGVkJyxcbiAgbG9nb3V0U3VjY2VzczogJ2F1dGgtbG9nb3V0LXN1Y2Nlc3MnLFxuICBzZXNzaW9uVGltZW91dDogJ2F1dGgtc2Vzc2lvbi10aW1lb3V0JyxcbiAgbm90QXV0aGVudGljYXRlZDogJ2F1dGgtbm90LWF1dGhlbnRpY2F0ZWQnLFxuICBub3RBdXRob3JpemVkOiAnYXV0aC1ub3QtYXV0aG9yaXplZCdcbn0pO1xuXG5hcHAuY29uc3RhbnQoJ1VTRVJfUk9MRVMnLCB7XG4gIGFsbDogJyonLFxuICBhZG1pbjogJ2FkbWluJyxcbiAgZWRpdG9yOiAnZWRpdG9yJyxcbiAgZ3Vlc3Q6ICdndWVzdCdcbn0pO1xuXG5cbmFwcC5zZXJ2aWNlKCdTZXNzaW9uJywgZnVuY3Rpb24gKCkge1xuICB0aGlzLmNyZWF0ZSA9IGZ1bmN0aW9uIChzZXNzaW9uSWQsIHVzZXJJZCwgdXNlclJvbGUpIHtcbiAgICB0aGlzLmlkID0gc2Vzc2lvbklkO1xuICAgIHRoaXMudXNlcklkID0gdXNlcklkO1xuICAgIHRoaXMudXNlclJvbGUgPSB1c2VyUm9sZTtcbiAgfTtcbiAgdGhpcy5kZXN0cm95ID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuaWQgPSBudWxsO1xuICAgIHRoaXMudXNlcklkID0gbnVsbDtcbiAgICB0aGlzLnVzZXJSb2xlID0gbnVsbDtcbiAgfTtcbiAgcmV0dXJuIHRoaXM7XG59KVxuXG4vLyAtLS0tLS1cbmFwcC5mYWN0b3J5KCdBdXRoU2VydmljZScsIGZ1bmN0aW9uICgkaHR0cCwgU2Vzc2lvbiwgVVNFUl9ST0xFUykge1xuICB2YXIgYXV0aFNlcnZpY2UgPSB7fTtcbiBcbiAgYXV0aFNlcnZpY2UubG9naW4gPSBmdW5jdGlvbiAoY3JlZGVudGlhbHMpIHtcbiAgICByZXR1cm4gJGh0dHBcbiAgICAgIC5wb3N0KCcvdXNlci9yZXN0L2xvZ2luJywgY3JlZGVudGlhbHMpXG4gICAgICAudGhlbihmdW5jdGlvbiAocmVzKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKHJlcy5kYXRhKVxuICAgICAgICBpZiAocmVzLmRhdGEuc3VjY2Vzcykge1xuICAgICAgICAgIFNlc3Npb24uY3JlYXRlKHJlcy5kYXRhLmlkLCByZXMuZGF0YS51c2VyLmlkLCBVU0VSX1JPTEVTLmFkbWluKTtcbiAgICAgICAgICByZXR1cm4gcmVzLmRhdGEudXNlclxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfSk7XG4gIH07XG4gXG4gIGF1dGhTZXJ2aWNlLmlzQXV0aGVudGljYXRlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gISFTZXNzaW9uLnVzZXJJZDtcbiAgfTtcbiBcbiAgYXV0aFNlcnZpY2UuaXNBdXRob3JpemVkID0gZnVuY3Rpb24gKGF1dGhvcml6ZWRSb2xlcykge1xuICAgIGlmICghYW5ndWxhci5pc0FycmF5KGF1dGhvcml6ZWRSb2xlcykpIHtcbiAgICAgIGF1dGhvcml6ZWRSb2xlcyA9IFthdXRob3JpemVkUm9sZXNdO1xuICAgIH1cbiAgICByZXR1cm4gKGF1dGhTZXJ2aWNlLmlzQXV0aGVudGljYXRlZCgpICYmXG4gICAgICBhdXRob3JpemVkUm9sZXMuaW5kZXhPZihTZXNzaW9uLnVzZXJSb2xlKSAhPT0gLTEpO1xuICB9O1xuIFxuICByZXR1cm4gYXV0aFNlcnZpY2U7XG59KTtcblxuYXBwLmZhY3RvcnkoJ2F1dGhTZXJ2aWNlJywgWyckaHR0cCcsICckcScsICdsb2NhbFN0b3JhZ2VTZXJ2aWNlJywgZnVuY3Rpb24gKCRodHRwLCAkcSwgbG9jYWxTdG9yYWdlU2VydmljZSkge1xuIFxuICAgIHZhciBzZXJ2aWNlQmFzZSA9ICdodHRwOi8vbmdhdXRoZW50aWNhdGlvbmFwaS5henVyZXdlYnNpdGVzLm5ldC8nO1xuICAgIHZhciBhdXRoU2VydmljZUZhY3RvcnkgPSB7fTtcbiBcbiAgICB2YXIgX2F1dGhlbnRpY2F0aW9uID0ge1xuICAgICAgICBpc0F1dGg6IGZhbHNlLFxuICAgICAgICB1c2VyTmFtZSA6IFwiXCJcbiAgICB9O1xuIFxuICAgIHZhciBfc2F2ZVJlZ2lzdHJhdGlvbiA9IGZ1bmN0aW9uIChyZWdpc3RyYXRpb24pIHtcbiBcbiAgICAgICAgX2xvZ091dCgpO1xuIFxuICAgICAgICByZXR1cm4gJGh0dHAucG9zdChzZXJ2aWNlQmFzZSArICdhcGkvYWNjb3VudC9yZWdpc3RlcicsIHJlZ2lzdHJhdGlvbikudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICAgICAgfSk7XG4gXG4gICAgfTtcbiBcbiAgICB2YXIgX2xvZ2luID0gZnVuY3Rpb24gKGxvZ2luRGF0YSkge1xuXG4gICAgICAgIGNvbnNvbGUubG9nKCdfbG9naW4nKTtcbiAgICAgICAgdmFyIGRhdGEgPSBcImdyYW50X3R5cGU9cGFzc3dvcmQmdXNlcm5hbWU9XCIgKyBsb2dpbkRhdGEudXNlck5hbWUgKyBcIiZwYXNzd29yZD1cIiArIGxvZ2luRGF0YS5wYXNzd29yZDtcbiBcbiAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcbiBcbiAgICAgICAgJGh0dHAucG9zdChzZXJ2aWNlQmFzZSArICd0b2tlbicsIGRhdGEsIHsgaGVhZGVyczogeyAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCcgfSB9KS5zdWNjZXNzKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuIFxuICAgICAgICAgICAgbG9jYWxTdG9yYWdlU2VydmljZS5zZXQoJ2F1dGhvcml6YXRpb25EYXRhJywgeyB0b2tlbjogcmVzcG9uc2UuYWNjZXNzX3Rva2VuLCB1c2VyTmFtZTogbG9naW5EYXRhLnVzZXJOYW1lIH0pO1xuIFxuICAgICAgICAgICAgX2F1dGhlbnRpY2F0aW9uLmlzQXV0aCA9IHRydWU7XG4gICAgICAgICAgICBfYXV0aGVudGljYXRpb24udXNlck5hbWUgPSBsb2dpbkRhdGEudXNlck5hbWU7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhyZXNwb25zZSk7XG4gICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlKTtcbiBcbiAgICAgICAgfSkuZXJyb3IoZnVuY3Rpb24gKGVyciwgc3RhdHVzKSB7XG4gICAgICAgICAgICBfYXV0aGVudGljYXRpb24uaXNBdXRoID0gdHJ1ZTtcbiAgICAgICAgICAgIF9hdXRoZW50aWNhdGlvbi51c2VyTmFtZSA9IGxvZ2luRGF0YS51c2VyTmFtZTtcbiAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUoe2E6ICdzJ30pO1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ2Vycm9yJyk7XG4gICAgICAgICAgICAvL19sb2dPdXQoKTtcblxuICAgICAgICAgICAgLy9kZWZlcnJlZC5yZWplY3QoZXJyKTtcbiAgICAgICAgfSk7XG4gXG4gICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuIFxuICAgIH07XG4gXG4gICAgdmFyIF9sb2dPdXQgPSBmdW5jdGlvbiAoKSB7XG4gXG4gICAgICAgIGxvY2FsU3RvcmFnZVNlcnZpY2UucmVtb3ZlKCdhdXRob3JpemF0aW9uRGF0YScpO1xuIFxuICAgICAgICBfYXV0aGVudGljYXRpb24uaXNBdXRoID0gZmFsc2U7XG4gICAgICAgIF9hdXRoZW50aWNhdGlvbi51c2VyTmFtZSA9IFwiXCI7XG4gXG4gICAgfTtcbiBcbiAgICB2YXIgX2ZpbGxBdXRoRGF0YSA9IGZ1bmN0aW9uICgpIHtcbiBcbiAgICAgICAgdmFyIGF1dGhEYXRhID0gbG9jYWxTdG9yYWdlU2VydmljZS5nZXQoJ2F1dGhvcml6YXRpb25EYXRhJyk7XG4gICAgICAgIGlmIChhdXRoRGF0YSlcbiAgICAgICAge1xuICAgICAgICAgICAgX2F1dGhlbnRpY2F0aW9uLmlzQXV0aCA9IHRydWU7XG4gICAgICAgICAgICBfYXV0aGVudGljYXRpb24udXNlck5hbWUgPSBhdXRoRGF0YS51c2VyTmFtZTtcbiAgICAgICAgfVxuIFxuICAgIH1cbiBcbiAgICBhdXRoU2VydmljZUZhY3Rvcnkuc2F2ZVJlZ2lzdHJhdGlvbiA9IF9zYXZlUmVnaXN0cmF0aW9uO1xuICAgIGF1dGhTZXJ2aWNlRmFjdG9yeS5sb2dpbiA9IF9sb2dpbjtcbiAgICBhdXRoU2VydmljZUZhY3RvcnkubG9nT3V0ID0gX2xvZ091dDtcbiAgICBhdXRoU2VydmljZUZhY3RvcnkuZmlsbEF1dGhEYXRhID0gX2ZpbGxBdXRoRGF0YTtcbiAgICBhdXRoU2VydmljZUZhY3RvcnkuYXV0aGVudGljYXRpb24gPSBfYXV0aGVudGljYXRpb247XG4gXG4gICAgcmV0dXJuIGF1dGhTZXJ2aWNlRmFjdG9yeTtcbn1dKTtcblxuYXBwLmZhY3RvcnkoJ2F1dGhJbnRlcmNlcHRvclNlcnZpY2UnLCBbJyRxJywgJyRsb2NhdGlvbicsICdsb2NhbFN0b3JhZ2VTZXJ2aWNlJywgZnVuY3Rpb24gKCRxLCAkbG9jYXRpb24sIGxvY2FsU3RvcmFnZVNlcnZpY2UpIHtcbiBcbiAgICB2YXIgYXV0aEludGVyY2VwdG9yU2VydmljZUZhY3RvcnkgPSB7fTtcbiBcbiAgICB2YXIgX3JlcXVlc3QgPSBmdW5jdGlvbiAoY29uZmlnKSB7XG4gXG4gICAgICAgIGNvbmZpZy5oZWFkZXJzID0gY29uZmlnLmhlYWRlcnMgfHwge307XG4gXG4gICAgICAgIHZhciBhdXRoRGF0YSA9IGxvY2FsU3RvcmFnZVNlcnZpY2UuZ2V0KCdhdXRob3JpemF0aW9uRGF0YScpO1xuICAgICAgICBpZiAoYXV0aERhdGEpIHtcbiAgICAgICAgICAgIGNvbmZpZy5oZWFkZXJzLkF1dGhvcml6YXRpb24gPSAnQmVhcmVyICcgKyBhdXRoRGF0YS50b2tlbjtcbiAgICAgICAgfVxuIFxuICAgICAgICByZXR1cm4gY29uZmlnO1xuICAgIH1cbiBcbiAgICB2YXIgX3Jlc3BvbnNlRXJyb3IgPSBmdW5jdGlvbiAocmVqZWN0aW9uKSB7XG4gICAgICAgIGlmIChyZWplY3Rpb24uc3RhdHVzID09PSA0MDEpIHtcbiAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvbG9naW4nKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gJHEucmVqZWN0KHJlamVjdGlvbik7XG4gICAgfVxuIFxuICAgIGF1dGhJbnRlcmNlcHRvclNlcnZpY2VGYWN0b3J5LnJlcXVlc3QgPSBfcmVxdWVzdDtcbiAgICBhdXRoSW50ZXJjZXB0b3JTZXJ2aWNlRmFjdG9yeS5yZXNwb25zZUVycm9yID0gX3Jlc3BvbnNlRXJyb3I7XG4gXG4gICAgcmV0dXJuIGF1dGhJbnRlcmNlcHRvclNlcnZpY2VGYWN0b3J5O1xufV0pO1xuXG5hcHAuY29uZmlnKGZ1bmN0aW9uICgkaHR0cFByb3ZpZGVyKSB7XG4gICAgJGh0dHBQcm92aWRlci5pbnRlcmNlcHRvcnMucHVzaCgnYXV0aEludGVyY2VwdG9yU2VydmljZScpO1xufSk7XG5cbiIsInZhciBwaG9uZUNvbnRyb2xsZXJzID0gYW5ndWxhci5tb2R1bGUoJ3Bob25lQ29udHJvbGxlcnMnLCBbXSk7XG5cbnBob25lQ29udHJvbGxlcnMuY29uc3RhbnQoJ0FVVEhfRVZFTlRTJywge1xuICBsb2dpblN1Y2Nlc3M6ICdhdXRoLWxvZ2luLXN1Y2Nlc3MnLFxuICBsb2dpbkZhaWxlZDogJ2F1dGgtbG9naW4tZmFpbGVkJyxcbiAgbG9nb3V0U3VjY2VzczogJ2F1dGgtbG9nb3V0LXN1Y2Nlc3MnLFxuICBzZXNzaW9uVGltZW91dDogJ2F1dGgtc2Vzc2lvbi10aW1lb3V0JyxcbiAgbm90QXV0aGVudGljYXRlZDogJ2F1dGgtbm90LWF1dGhlbnRpY2F0ZWQnLFxuICBub3RBdXRob3JpemVkOiAnYXV0aC1ub3QtYXV0aG9yaXplZCdcbn0pXG5cbnBob25lQ29udHJvbGxlcnMuY29udHJvbGxlcignVXNlci1TaWdudXBDb250cm9sbGVyXycsIGZ1bmN0aW9uICgkc2NvcGUsIFVTRVJfUk9MRVMsIEF1dGhTZXJ2aWNlKSB7XG4gICRzY29wZS5jdXJyZW50VXNlciA9IG51bGw7XG4gICRzY29wZS51c2VyUm9sZXMgPSBVU0VSX1JPTEVTO1xuICAkc2NvcGUuaXNBdXRob3JpemVkID0gQXV0aFNlcnZpY2UuaXNBdXRob3JpemVkO1xuIFxuICAkc2NvcGUuc2V0Q3VycmVudFVzZXIgPSBmdW5jdGlvbiAodXNlcikge1xuICAgICRzY29wZS5jdXJyZW50VXNlciA9IHVzZXI7XG4gIH07XG59KTtcblxucGhvbmVDb250cm9sbGVycy5jb250cm9sbGVyKCdVc2VyLWxvZ2luQ29udHJvbGxlcicsIFsnJHNjb3BlJywgJyRyb290U2NvcGUnLCAnQVVUSF9FVkVOVFMnLCAnQXV0aFNlcnZpY2UnLCBmdW5jdGlvbiAoJHNjb3BlLCAkcm9vdFNjb3BlLCBBVVRIX0VWRU5UUywgQXV0aFNlcnZpY2UpIHtcbiAgY29uc29sZS5sb2coJ2luaXQnKTtcbiAgJHNjb3BlLmNyZWRlbnRpYWxzID0ge1xuICAgIHVzZXJuYW1lOiAnbG9naW4nLFxuICAgIHBhc3N3b3JkOiAncGFzc3dvcmQnXG4gIH07XG4gIFxuICAkc2NvcGUubG9naW4gPSBmdW5jdGlvbiAoY3JlZGVudGlhbHMpIHtcbiAgICBBdXRoU2VydmljZS5sb2dpbihjcmVkZW50aWFscykudGhlbihmdW5jdGlvbiAodXNlcikge1xuICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KEFVVEhfRVZFTlRTLmxvZ2luU3VjY2Vzcyk7XG4gICAgICAkc2NvcGUuc2V0Q3VycmVudFVzZXIodXNlcik7XG4gICAgfSwgZnVuY3Rpb24gKCkge1xuICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KEFVVEhfRVZFTlRTLmxvZ2luRmFpbGVkKTtcbiAgICB9KTtcbiAgfTtcbn1dKVxuXG5waG9uZUNvbnRyb2xsZXJzLmNvbnRyb2xsZXIoJ1Bob25lLUxpc3RDdHJsJywgWyckc2NvcGUnLCAnJGh0dHAnLFxuICBmdW5jdGlvbiAoJHNjb3BlLCAkaHR0cCkge1xuICAgICRodHRwLmdldCgnL3N0YXRpYy9hcHAvcGhvbmVzL3Bob25lcy5qc29uJykuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7XG4gICAgICAkc2NvcGUucGhvbmVzID0gZGF0YTtcbiAgICB9KTtcblxuICAgICRzY29wZS5vcmRlclByb3AgPSAnYWdlJztcbiAgfV0pO1xuXG5waG9uZUNvbnRyb2xsZXJzLmNvbnRyb2xsZXIoJ1Bob25lLURldGFpbEN0cmwnLCBbJyRzY29wZScsICckcm91dGVQYXJhbXMnLFxuICBmdW5jdGlvbigkc2NvcGUsICRyb3V0ZVBhcmFtcykge1xuICAgICRzY29wZS5waG9uZUlkID0gJHJvdXRlUGFyYW1zLnBob25lSWQ7XG4gIH1dKTtcblxuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9